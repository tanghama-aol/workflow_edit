# 嵌套工作流编辑器 - 需求文档

## 1. 概述

本文档旨在详细说明一个基于 JointJS 的交互式嵌套工作流编辑器的功能需求。该编辑器应允许用户通过图形化界面创建、组织和管理复杂的工作流程。

## 2. 功能需求

### 2.1. 节点管理

- **2.1.1. 拖拽添加节点**: 用户应能够从一个侧边栏（“Stencil”）中选择不同类型的预定义节点，并将其拖拽到画布上。
    - 至少应提供两种基本节点类型（例如，“任务”和“判断”）。
    - 应提供一种特殊的“容器”节点类型。
- **2.1.2. 节点编辑**: 用户应能够修改节点的属性。
    - 点击节点上的“编辑”按钮，应弹出一个对话框。
    - 在对话框中，用户可以修改节点的标签文本和背景颜色。

### 2.2. 连接管理

- **2.2.1. 创建连接**: 用户应能够通过从一个节点的输出端口拖拽到另一个节点的输入端口来创建连接（“Link”）。
- **2.2.2. 连接校验**: 系统应阻止无效的连接，例如：
    - 连接不能指向其自身。
    - 连接只能在端口之间建立。

### 2.3. 嵌套功能

- **2.3.1. 容器嵌套**: 用户应能够将子节点拖拽到“容器”节点内部，以实现嵌套。
    - 只有标记为“容器”的节点才能接受子节点。
- **2.3.2. 子节点跟随**: 当用户拖动父容器时，所有嵌套在其中的子节点必须随之同步移动。
- **2.3.3. 拖出容器**: 用户应能够将子节点从容器中拖拽出来，解除其嵌套关系。

### 2.4. 用户界面与体验

- **2.4.1. 界面布局**: 
    - 左侧为节点选择面板（Stencil）。
    - 右侧为主画布区域（Paper）。
- **2.4.2. 自定义样式**: 节点的视觉样式（如颜色、形状、边框）应是可配置和可修改的，以提高可读性和美观性。
- **2.4.3. 整体美化**: 整体界面应遵循现代设计原则，提供一个干净、直观且响应迅速的用户体验。
- **2.4.4. 编辑工具**: 当鼠标悬停在节点上时，应显示一个编辑按钮，用于触发编辑对话框。

## 3. 非功能性需求

- **3.1. 技术栈**: 应用应使用原生 JavaScript 和 JointJS 库实现，不依赖于任何前端框架（如 React, Vue, Angular）。
- **3.2. 浏览器兼容性**: 应兼容最新版本的 Chrome、Firefox 和 Edge 浏览器。
- **3.3. 性能**: 编辑器在处理中等规模（例如 100 个节点）的工作流时，应保持流畅的性能。
